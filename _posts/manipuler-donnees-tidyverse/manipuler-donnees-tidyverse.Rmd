---
title: "Manipulation de données"
description: |
  Manipuler et mettre en forme vos données à l'aide du Tidyverse.
author:
  - name: Sandra Angers-Blondin
    url: https://ourcodingclub.github.io/tutorials/data-manip-intro
  - name: Jonathan Kitt (adaptation)
    url: {}
date: 2022-05-20
categories:
  - R
  - RStudio
  - Données
  - Tidyverse
output:
  distill::distill_article:
    toc: true
    toc_depth: 1
    self_contained: false
draft: true
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

*Ce tutoriel est adapté de [Basic data manipulation](https://ourcodingclub.github.io/tutorials/data-manip-intro/index.html) du site [Our Coding Club](https://ourcodingclub.github.io/).* 

# Introduction

```{r, layout="l-body-outset"}
knitr::include_graphics("img/data_cowboy.png")
```
Dessin de [Allison Horst](https://raw.githubusercontent.com/allisonhorst/stats-illustrations/master/rstats-artwork/data_cowboy.png)

<br>

Les formats de nos données peuvent varier, et un format utile et pratique dans un cas précis ne le sera pas forcément pour un autre. La maîtrise des outils de manipulation et de mise en forme des données est donc essentielle !

Les **objectifs** de ce tutoriel sont les suivants :  

1. Utiliser la `syntaxe R basique` pour manipuler des données
2. Utiliser les outils du package `dplyr` pour manipuler des données  
3. Mettre en forme des données à l'aide du package `tidyr`

Voici les **étapes** que nous allons suivre pour y parvenir :  
<br>

1. [Utiliser la syntaxe R basique pour manipuler des données](#basic)  
2. [Exploiter les outils du Tidyverse pour manipuler des données](#tidyverse) :  
    - [Explorer les principales fonctions de `dplyr`](#dplyr) : [`rename()`](#rename), [`filter()`](#filter),                 [`select()`](#select), [`arrange()`](#arrange), [`mutate()`](#mutate), [`group_by()`](#groupby),                        [`summarise()`](#summarise), [`join()`](#join)  
    - [Mettre en forme des données à l'aide du package `tidyr`](#tidyr) : [`pivot_longer()`](#pivotlonger),                   [`pivot_wider()`](#pivotwider)  
3. [Défi](#defi)

<br>

Vous pouvez revoir les bases de R et RStudio dans le tutoriel [Premiers pas avec R](https://codons.netlify.app/posts/premiers-pas-avec-r/).

<br>

## Importer les données

Ouvrez un nouveau script et importez le jeu de données `croissance.csv`. Il s'agit d'un tableau contenant des mesures de croissance annuelle de tiges d'arbrisseaux (*Empetrum nigrum* ou camarine noire) qui poussent dans des dunes de sable. Ces arbrisseaux sont situés dans des zones, allant de la plus proche (2) à la plus éloignée (7) de la mer.

```{r, out.width="100%"}
knitr::include_graphics("img/empetrum.jpg")
```
[*Empetrum nigrum* ou camarine noire](https://fr.wikipedia.org/wiki/Empetrum_nigrum)

```{r, echo=TRUE, eval=FALSE}
# Ateliers codons!
# 02 - Manipulation de donnees
# Lundi 30/05/2022

# Definir le repertoire de travail

setwd("C-02-ManipulationDonnees")

# Importer le jeu de donnees

croissance <- read.csv("https://raw.githubusercontent.com/codons-blog/C-02-ManipulationDonneesBases/main/croissance.csv")

# Explorer les donnees

head(croissance)  # affiche les premieres lignes
str(croissance)  # types des variables
croissance$Indiv  # individus
length(unique(croissance$Indiv))  # nombre d'individus
```

# Manipulation de données à l'aide de la syntaxe R basique {#basic}

Vous pouvez sélectionner une partie des données à l'aide des crochets `[ , ]` : le chiffre à gauche de la virgule désigne les lignes et le chiffre à droite les colonnes. Un espace vide à gauche ou à droite de la virgule permet de sélectionner respectivement toutes les lignes ou toutes les colonnes.

```{r, echo=TRUE, eval=FALSE}
# Selectionner une partie des donnees

croissance[2, 5]  # 2e ligne, 5e colonne
croissance[6, ]  # 6e ligne
croissance[6, ]$Indiv  # 6e ligne de la variable Indiv
croissance[croissance$Indiv == 603, ]  # individu n°603
```

### Les opérateurs logiques

Voici les opérateurs les plus fréquemment utilisés pour sélectionner des données : 

Opérateur   Expression logique
----------  -------------------
==          strictement égal à
<=          inférieur ou égal à
<           inférieur à
>=          supérieur ou égal à
>           supérieur à
!=          différent de
%in%        appartient à
&           ET
|           OU
!           PAS  

Voyons comment les utiliser : 

```{r, echo=TRUE, eval=FALSE}
# Une seule condition

croissance[croissance$Zone < 4, ]  # zones 2 et 3
croissance[croissance$Zone <= 4, ]  # zones 2, 3 et 4
croissance[!croissance$Zone >= 5, ]  # zones 2, 3 et 4

# Deux conditions

croissance[croissance$Zone == 2 | croissance$Zone == 7, ]  # zones 2 et 7
croissance[croissance$Zone == 2 & croissance$Indiv %in% c(300:400), ]  # zone 2, identifiants entre 300 et 400
```

### Construction de séquences

Dans la dernière commande, la fonction `c(300:400)` permet de sélectionner les individus ayant des identifiants entre 300 et 400. Il existe d'autres façons de construire une séquence :  

- `seq(300, 400, 10)` : de 300 à 400 par incrément de 10  
  
- `rep(c(1, 2), 3)` : `1 2` répété 3 fois

<aside>
Que donnera `rep(seq(0, 30, 10), 4)` ?
</aside>

Lorsqu'on manipule des données, il est préférable de créer une **copie de travail** de l'objet d'origine pour ne pas l'écraser.

```{r, echo=TRUE, eval=FALSE}
# Creer une copie de travail de l'objet d'origine

croissance2 <- croissance

# Modifier des noms de colonnes

names(croissance2)[1] <- "zone"  # 1e colonne
names(croissance2)[2] <- "ID"  # 2e colonne

# Modifier une valeur

croissance2[1, 4] <- 5.7  # remplace la valeur dans la 1e ligne, 4e colonne par 5.7
croissance2[croissance2$ID == 373, ]$X2008 <- 5.7  # meme chose avec des operateurs logiques

# Creer un facteur
str(croissance2)  # types de variables
croissance2$zone <- as.factor(croissance2$zone)  # definir la variable zone comme facteur
str(croissance2)  # verification

# Modifier les niveaux d'un facteur
levels(croissance2$zone)  # affiche les niveaux de la variable
levels(croissance2$zone) <- c("A", "B", "C", "D", "E", "F")
```

