---
title: "Visualisation de données"
description: |
  Créer des graphiques avec ggplot2.
author:
  - name: Jonathan Kitt
date: 2022-06-30
categories:
  - R
  - RStudio
  - Graphiques
  - ggpplot2
  - Tidyverse
output:
  distill::distill_article:
    toc: true
    toc_depth: 1
    self_contained: false
draft: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

# Introduction

```{r, layout="l-body"}
knitr::include_graphics("img/ggplot2_blank.png")
```
Dessin de [Allison Horst](https://github.com/allisonhorst/stats-illustrations/blob/master/rstats-blanks/ggplot2_blank.png)

<br>

Nous avons vu comment [importer nos données dans RStudio](https://codons.netlify.app/posts/premiers-pas-avec-r/), et comment [les manipuler et les mettre en forme](https://codons.netlify.app/posts/manipuler-donnees-tidyverse/).  

<br>

Dans ce tutoriel nous allons voir comment communiquer les résultats de nos analyses - à l'aide de la **visualisation de données** :

<br>

**1. [Construire un graphique `ggplot2`](#construction)**  

**3. [Créer des graphiques basiques](#creer)** :  

- [nuage de points (scatter plot)](#scatterplot) 

- [histogramme](#histogram)  
  
- [boîtes à moustaches (box plot)](#boxplot)  
  
- [diagramme en bâtons (bar plot)](#barplot)  

- [graphiques multiples (facet)](#facet)

**3. [Exporter un graphique](#exporter)**

**4. [Améliorer ses graphiques](#ameliorer)**

**5. [Assembler ses graphiques à l'aide de `patchwork`](#patchwork)**

**6. [Défi](#defi)**

<br> 

# Construire un graphique `ggplot2` {#construire}

Le package `ggplot2` (qui fait partie de la suite Tidyverse) repose sur le principe de **grammaire des graphiques** : notre visualisation se construit étape par étape, en procédant par **couches**, comme le montre la figure ci-dessous.

```{r, layout="l-body"}
knitr::include_graphics("img/ggplot-grammar-of-graphics.png")
```
Figure tirée de [ggplot2 et la grammaire des graphiques](https://larmarange.github.io/analyse-R/ggplot2.html)

<br>

Toutes ces couches ne sont pas nécessaires à la construction d'un graphique.  
La figure ci-dessous montre de manière simplifiée comment créer un `ggplot` basique : 

**1) `ggplot()`** : initialisation de l'outil graphique  

**2) `aes()`** : paramètres esthétiques (répartition des variables sur les axes, couleurs, ...)  

**3) `geom()`** : type de représentation (points, lignes, ...)  

**4) `theme()`** : apparence du graphique (arrière-plan, taille et alignement du texte, ...)

```{r, layout="l-page"}
knitr::include_graphics("img/ggplot_01.gif")
```

Vous remarquerez dans le code la présence du signe **"+"** à la fin de chaque ligne : c'est ce qui permet d'ajouter une couche à votre graphique.

# Créer des graphiques basiques {#creer}

Commençons par ouvrir un nouveau script R et importer le jeu de données :

```{r, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
library(tidyverse)

pingouins <- readr::read_csv("https://raw.githubusercontent.com/codons-blog/C-04-VisualisationDonnees/main/pingouins.csv")
```

```{r, echo=TRUE, eval=FALSE, message=FALSE, warning=FALSE}
# Ateliers codons!
# 04 - Visualisation de donnees avec ggplot2
# 2022-06-30

# Definir le repertoire de travail ----

setwd("codons/C-04-VisualisationDonnees")

# Charger le Tidyverse ----

library(tidyverse)

# Importer le jeu de donnees ----

pingouins <- readr::read_csv("https://raw.githubusercontent.com/codons-blog/C-04-VisualisationDonnees/main/pingouins.csv")
```

<br>

Il est toujours utile de vérifier les données importées avant d'aller plus loin :

```{r, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
glimpse(pingouins)
```

<br>

Il s'agit du jeu de données [Palmer penguins](https://allisonhorst.github.io/palmerpenguins/), disponible dans le package R [palmerpenguins](https://cloud.r-project.org/web/packages/palmerpenguins/index.html).  

Différents paramètres ont été mesurés sur trois espèces de pingouins, sur trois îles de l'archipel Palmer en Antarctique. 

```{r, layout="l-body"}
knitr::include_graphics("img/lter_penguins.png")
```
Dessin de [Allison Horst](https://allisonhorst.github.io/palmerpenguins/reference/figures/lter_penguins.png)

## Nuage de points (scatter plot){#scatterplot}

Intéressons-nous au bec des pingouins en répondant à la question suivante : **quelle est la distribution du rapport entre la hauteur du bec et sa longueur ?**.  
  
Afin de bien comprendre comment construire un graphique avec `ggplot2`, procédons étape par étape.

<br>

```{r, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
# Initialiser l'outil graphique
ggplot(data = pingouins)
```

```{r, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
# Paramètres esthétiques : répartition des variables sur les axes
ggplot(data = pingouins,
       mapping = aes(x = bec_lngr_mm,
                     y = bec_htr_mm))
```

```{r, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
# Type de visualisation : points
ggplot(data = pingouins,
       mapping = aes(x = bec_lngr_mm,
                     y = bec_htr_mm)) +
  geom_point()
```

<br>

Voilà la distribution que nous cherchons à observer. C'est un bon début, mais cela manque de couleurs ...  

Il existe deux façons d'ajouter des couleurs à un `ggplot` :  

- **définir une couleur pour l'ensemble des points** : on placera alors le paramètre couleur **en dehors de la parenthèse `aes()`**.

```{r, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
# Une couleur pour l'ensemble des points
ggplot(data = pingouins,
       mapping = aes(x = bec_lngr_mm,
                     y = bec_htr_mm)) +
  geom_point(colour = "red")
```

- **colorer les points en fonction d'une autre variable** : on placera dans ce cas le paramètre couleur **à l'intérieur de la parenthèse `aes()`**.

```{r, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
# Colorer les points en fonction de l'espece
ggplot(data = pingouins,
       mapping = aes(x = bec_lngr_mm,
                     y = bec_htr_mm)) +
  geom_point(aes(colour = espece))
```

Vous pouvez voir qu'une **légende** permettant de différencier les trois espèces a été ajoutée à droite du graphique.

Nous aimerions utiliser les mêmes couleurs que celles de la documentation du jeu de données. Nous utilisons pour cela le paramètre `scale_colour_manual()` : 

```{r, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
# Modifier les couleurs
ggplot(data = pingouins,
       mapping = aes(x = bec_lngr_mm,
                     y = bec_htr_mm)) +
  geom_point(aes(colour = espece)) +
  scale_colour_manual(values = c("Adelie" = "darkorange",
                                 "Chinstrap" = "purple",
                                 "Gentoo" = "cyan4"))
```

La taille des points nous semble trop petite : nous allons l'augmenter à l'aide de `size` :

<aside>
Prend une valeur numérique, par défaut 1
</aside>

```{r, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
# Augmenter la taille des points
ggplot(data = pingouins,
       mapping = aes(x = bec_lngr_mm,
                     y = bec_htr_mm)) +
  geom_point(aes(colour = espece),
             size = 3) +
  scale_colour_manual(values = c("Adelie" = "darkorange",
                                 "Chinstrap" = "purple",
                                 "Gentoo" = "cyan4"))
```

Afin de rendre le graphique plus lisible, nous pouvons ajouter de la transparence aux points à l'aide du paramètre `alpha` : 

<aside>
Entre 0 et 1, par opacité croissante
</aside>

```{r, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
# Ajouter de la transparence
ggplot(data = pingouins,
       mapping = aes(x = bec_lngr_mm,
                     y = bec_htr_mm)) +
  geom_point(aes(colour = espece),
             size = 3,
             alpha = 0.5) +
  scale_colour_manual(values = c("Adelie" = "darkorange",
                                 "Chinstrap" = "purple",
                                 "Gentoo" = "cyan4"))
```

Nous allons maintenant ajouter un titre et un sous-titre à notre graphique, et modifier les titres des axes pour les rendre plus explicites : 

```{r, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
# Ajouter ou modifier les titres du graphique et des axes
ggplot(data = pingouins,
       mapping = aes(x = bec_lngr_mm,
                     y = bec_htr_mm)) +
  geom_point(aes(colour = espece),
             size = 3,
             alpha = 0.5) +
  scale_colour_manual(values = c("Adelie" = "darkorange",
                                 "Chinstrap" = "purple",
                                 "Gentoo" = "cyan4")) +
  labs(title = "Rapport entre la hauteur et la longueur du bec",
       subtitle = "pour trois espèces de pingouins de l'archipel Palmer",
       x = "Longueur du bec (mm)",
       y = "Hauteur du bec (mm)")
```

Le fond gris du graphique est proposé par défaut par `ggplot2` : il s'agit d'un **thème** définissant l'apparence générale du graphique (couleurs de l'arrière-plan, de la grille, présence ou non d'un cadre, ...).
Nous allons utiliser l'un des autres thèmes prédéfinis dans `ggplot2`, le thème **"minimal"** à l'aide du paramètre `theme_minimal()`.

<br>
Il en existe d'autres : `theme_light()`, `theme_bw()`, `theme_void()`, ... 
N'hésitez pas à les essayer pour trouver celui qui vous convient le mieux ! 

```{r, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
# Changer le thème
ggplot(data = pingouins,
       mapping = aes(x = bec_lngr_mm,
                     y = bec_htr_mm)) +
  geom_point(aes(colour = espece),
             size = 3,
             alpha = 0.5) +
  scale_colour_manual(values = c("Adelie" = "darkorange",
                                 "Chinstrap" = "purple",
                                 "Gentoo" = "cyan4")) +
  labs(title = "Rapport entre la hauteur et la longueur du bec",
       subtitle = "pour trois espèces de pingouins de l'archipel Palmer",
       x = "Longueur du bec (mm)",
       y = "Hauteur du bec (mm)") +
  theme_minimal()
```

### Une note sur les formes et les couleurs

Nous pourrions également modifier la forme de nos points, à l'aide du paramètre `shape`. 
Il existe 25 types de points, comme montré ci-dessous.

```{r, layout="l-body"}
knitr::include_graphics("img/geom_point_shapes.png")
```

La façon de colorer les points dépend de la forme choisie : 

- couleur appliquée au **contour** pour les formes **0 à 14** à l'aide de `colour = ...`  

- couleur appliquée à l'**intérieur** pour les formes **15 à 20** à l'aide de `fill = ...`  

- couleur appliquée **au contour et à l'intérieur** pour les formes **21 à 24** à l'aide de ces deux paramètres, avec la même couleur ou des couleurs différentes. Pour ces cinq formes, la largeur du contour peut être modifiée à l'aide de `stroke = ...` (prend une valeur numérique).

Pour donner un exemple, nous pouvons ajouter à nos points un contour noir : 

```{r, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
# Changer la forme des points
ggplot(data = pingouins,
       mapping = aes(x = bec_lngr_mm,
                     y = bec_htr_mm)) +
  geom_point(aes(fill = espece),
             shape = 23,
             stroke = 2,
             colour = "black",
             size = 3,
             alpha = 0.5) +
  scale_fill_manual(values = c("Adelie" = "darkorange",
                                 "Chinstrap" = "purple",
                                 "Gentoo" = "cyan4")) +
  labs(title = "Rapport entre la hauteur et la longueur du bec",
       subtitle = "pour trois espèces de pingouins de l'archipel Palmer",
       x = "Longueur du bec (mm)",
       y = "Hauteur du bec (mm)") +
  theme_minimal()
```

**Attention à la logique du code !!** Nous avons choisi de colorer l'intérieur de nos points en fonction de l'espèce : `geom_point(aes(fill = espece))`. Il faut donc modifier la ligne qui nous permet de changer les couleurs : **`scale_fill_manual()`** remplace `scale_colour_manual()` utilisé précédemment. 

<br>

Le package `ggplot2` propose de nombreuses palettes de couleurs : 

<aside>
[Palettes prédéfinies dans `ggplot2`](http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/#rcolorbrewer-palette-chart)
</aside>

```{r, layout="l-body"}
knitr::include_graphics("img/rcolorbrewer.png")
```

Ces différentes palettes peuvent être utilisées à l'aide de `scale_colour_brewer()` ou `scale_fill_brewer()`.
Essayons la palette *Set3* : 

```{r, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
# Utiliser une palette de couleurs
ggplot(data = pingouins,
       mapping = aes(x = bec_lngr_mm,
                     y = bec_htr_mm)) +
  geom_point(aes(colour = espece),
             size = 3,
             alpha = 0.5) +
  scale_colour_brewer(palette = "Set3") +
  labs(title = "Rapport entre la hauteur et la longueur du bec",
       subtitle = "pour trois espèces de pingouins de l'archipel Palmer",
       x = "Longueur du bec (mm)",
       y = "Hauteur du bec (mm)") +
  theme_minimal()
```

Il existe beaucoup d'autres palettes, accessibles via des packages, dont la liste est [accessible ici](https://github.com/EmilHvitfeldt/r-color-palettes).

## Histogramme {#histogram}

Essayons maintenant de répondre à la question suivante : **quelle est la distribution de la longueur des ailes ?**.
<br>
Nous allons pour cela générer un histogramme à l'aide de `geom_histogram()` :

```{r, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
# Histogramme
ggplot(data = pingouins,
       mapping = aes(x = aile_lngr_mm)) +
  geom_histogram(aes(fill = espece),
                 alpha = 0.5) +
  scale_fill_manual(values = c("Adelie" = "darkorange",
                                 "Chinstrap" = "purple",
                                 "Gentoo" = "cyan4")) +
  labs(title = "Distribution de la longueur des ailes",
       subtitle = "pour trois espèces de pingouins de l'archipel Palmer",
       x = "Longueur des ailes (mm)",
       y = "Fréquence") +
  theme_minimal()
```

Il existe trois manières d'arranger la position des histogrammes des différents groupes : 

**1) `position = "stack` (par défaut)** : voir ci-dessus.

**2) `position = "identity`** : 
```{r, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
# Histogramme - position = "identity"
ggplot(data = pingouins,
       mapping = aes(x = aile_lngr_mm)) +
  geom_histogram(aes(fill = espece),
                 alpha = 0.5,
                 position = "identity") +
  scale_fill_manual(values = c("Adelie" = "darkorange",
                                 "Chinstrap" = "purple",
                                 "Gentoo" = "cyan4")) +
  labs(title = "Distribution de la longueur des ailes",
       subtitle = "pour trois espèces de pingouins de l'archipel Palmer",
       x = "Longueur des ailes (mm)",
       y = "Fréquence") +
  theme_minimal()
```

**3) `position = "dodge`** 
```{r, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
# Histogramme - position = "dodge"
ggplot(data = pingouins,
       mapping = aes(x = aile_lngr_mm)) +
  geom_histogram(aes(fill = espece),
                 alpha = 0.5,
                 position = "dodge") +
  scale_fill_manual(values = c("Adelie" = "darkorange",
                                 "Chinstrap" = "purple",
                                 "Gentoo" = "cyan4")) +
  labs(title = "Distribution de la longueur des ailes",
       subtitle = "pour trois espèces de pingouins de l'archipel Palmer",
       x = "Longueur des ailes (mm)",
       y = "Fréquence") +
  theme_minimal()
```

Lorsque vous exécutez ce code, vous pouvez lire le message suivant dans la console : **`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.**

<br>

Cela vous signale que le nombre de classes (bins) choisi pour l'histogramme n'est peut-être pas idéal.

<br>

Vous pouvez modifier ces classes de deux façons : 

**1) en modifiant la largeur de chaque classe sur l'axe x : `binwidth = ...`**

**2) en modifiant le nombre de classes à afficher : `bins = ...`**

<br>

Modifions ces paramètres pour voir le résultat : 

```{r, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
# Histogramme - position = "identity" - binwidth = 0.5
ggplot(data = pingouins,
       mapping = aes(x = aile_lngr_mm)) +
  geom_histogram(aes(fill = espece),
                 alpha = 0.5,
                 position = "identity",
                 binwidth = 0.5) +
  scale_fill_manual(values = c("Adelie" = "darkorange",
                                 "Chinstrap" = "purple",
                                 "Gentoo" = "cyan4")) +
  labs(title = "Distribution de la longueur des ailes",
       subtitle = "pour trois espèces de pingouins de l'archipel Palmer",
       x = "Longueur des ailes (mm)",
       y = "Fréquence") +
  theme_minimal()
```

<br>

```{r, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
# Histogramme - position = "identity" - bins = 15
ggplot(data = pingouins,
       mapping = aes(x = aile_lngr_mm)) +
  geom_histogram(aes(fill = espece),
                 alpha = 0.5,
                 position = "identity",
                 bins = 15) +
  scale_fill_manual(values = c("Adelie" = "darkorange",
                                 "Chinstrap" = "purple",
                                 "Gentoo" = "cyan4")) +
  labs(title = "Distribution de la longueur des ailes",
       subtitle = "pour trois espèces de pingouins de l'archipel Palmer",
       x = "Longueur des ailes (mm)",
       y = "Fréquence") +
  theme_minimal()
```

## Boîtes à moustaches (box plot) {#boxplot}

Intéressons-nous maintenant à la masse de nos pingouins : **les masses des trois espèces sont-elles similaires ?**  

<br>

Nous allons créer un graphique en boîte à moustaches à l'aide de `geom_boxplot()` : 

```{r, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
# Boxplots
ggplot(data = pingouins,
       mapping = aes(x = espece,
                     y = masse_g)) +
  geom_boxplot(aes(colour = espece)) +
  scale_colour_manual(values = c("Adelie" = "darkorange",
                                 "Chinstrap" = "purple",
                                 "Gentoo" = "cyan4")) +
  labs(title = "Distribution de la masse corporelle",
       subtitle = "pour trois espèces de pingouins de l'archipel Palmer",
       x = "Espèce",
       y = "Masse (g)") +
  theme_minimal()
```

Nous pouvons apporter quelques modifications à ce graphique : 

- comme il y a une boîte à moustaches par espèce, nous **pouvons supprimer la légende à l'aide de `show_legend = FALSE`**  

- pour la même raison, nous pouvons **supprimer le titre de l'axe x : `labs(x = "")`**  

- nous pouvons **supprimer les données aberrantes (outliers) : `outlier.shape = NA`**  

- **réduire la largeur des boxplots avec `width`**

- **ajouter de la couleur à l'intérieur des boîtes à moustaches avec `aes(fill = espece)`** : bien penser à ajouter `scale_fill_manual()` !

- **augmenter l'épaisseur des lignes avec `lwd`** (line width)

```{r, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
# Boxplots avec quelques modifications
ggplot(data = pingouins,
       mapping = aes(x = espece,
                     y = masse_g)) +
  geom_boxplot(aes(colour = espece,
                   fill = espece),
               show.legend = FALSE,
               outlier.shape = NA,
               width = 0.25,
               alpha = 0.5,
               lwd = 0.75) +
  scale_colour_manual(values = c("Adelie" = "darkorange",
                                 "Chinstrap" = "purple",
                                 "Gentoo" = "cyan4")) +
  scale_fill_manual(values = c("Adelie" = "darkorange",
                                 "Chinstrap" = "purple",
                                 "Gentoo" = "cyan4")) +
  labs(title = "Distribution de la masse corporelle",
       subtitle = "pour trois espèces de pingouins de l'archipel Palmer",
       x = "",
       y = "Masse (g)") +
  theme_minimal()
```

<br>

Si nous préférons des boxplots horizontaux, nous pouvons procéder de deux façons : 

**1) inverser les variables x et y**, en pensant bien à modifier également les titres des axes avec `labs()` : 

```{r, echo=TRUE, eval=FALSE, message=FALSE, warning=FALSE}
# Boxplots horizontaux : inverser les variables x et y
ggplot(data = pingouins,
       mapping = aes(x = masse_g,
                     y = espece)) +
  geom_boxplot(aes(colour = espece,
                   fill = espece),
               show.legend = FALSE,
               outlier.shape = NA,
               width = 0.25,
               alpha = 0.5,
               lwd = 0.75) +
  scale_colour_manual(values = c("Adelie" = "darkorange",
                                 "Chinstrap" = "purple",
                                 "Gentoo" = "cyan4")) +
  scale_fill_manual(values = c("Adelie" = "darkorange",
                                 "Chinstrap" = "purple",
                                 "Gentoo" = "cyan4")) +
  labs(title = "Distribution de la masse corporelle",
       subtitle = "pour trois espèces de pingouins de l'archipel Palmer",
       x = "Masse (g)",
       y = "") +
  theme_minimal()
```

<br>

**2) utiliser `coord_flip()`** pour inverser les coordonnées : 

```{r, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
# Boxplots horizontaux : inverser les coordonnées avec coord_flip()
ggplot(data = pingouins,
       mapping = aes(x = espece,
                     y = masse_g)) +
  geom_boxplot(aes(colour = espece,
                   fill = espece),
               show.legend = FALSE,
               outlier.shape = NA,
               width = 0.25,
               alpha = 0.5,
               lwd = 0.75) +
  scale_colour_manual(values = c("Adelie" = "darkorange",
                                 "Chinstrap" = "purple",
                                 "Gentoo" = "cyan4")) +
  scale_fill_manual(values = c("Adelie" = "darkorange",
                                 "Chinstrap" = "purple",
                                 "Gentoo" = "cyan4")) +
  labs(title = "Distribution de la masse corporelle",
       subtitle = "pour trois espèces de pingouins de l'archipel Palmer",
       x = "",
       y = "Masse (g)") +
  coord_flip() +
  theme_minimal()
```

Nous pouvons ajouter à ces box plots des scatter plots pour visualiser les données sous-jacentes :

```{r, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
# Boxplots + scatter plots
ggplot(data = pingouins,
       mapping = aes(x = espece,
                     y = masse_g)) +
  geom_boxplot(aes(colour = espece,
                   fill = espece),
               show.legend = FALSE,
               outlier.shape = NA,
               width = 0.25,
               alpha = 0.5,
               lwd = 0.75) +
  geom_point(aes(colour = espece),
             show.legend = FALSE,
             alpha = 0.25) +
  scale_colour_manual(values = c("Adelie" = "darkorange",
                                 "Chinstrap" = "purple",
                                 "Gentoo" = "cyan4")) +
  scale_fill_manual(values = c("Adelie" = "darkorange",
                                 "Chinstrap" = "purple",
                                 "Gentoo" = "cyan4")) +
  labs(title = "Distribution de la masse corporelle",
       subtitle = "pour trois espèces de pingouins de l'archipel Palmer",
       x = "",
       y = "Masse (g)") +
  coord_flip() +
  theme_minimal()
```

Nous aimerions espacer un peu les points pour rendre le graphique plus lisible. Nous allons pour cela utiliser un autre type de visualisation de nuages de points : `geom_jitter()`. Les paramètres `height` et `width` permettent d'ajuster l'étalement du nuage respectivement en hauteur et en largeur. L'utilisation de l'un ou l'autre de ces paramètres dépendra de l'orientation de nos nuages de points (répartition des variables sur les axes x et y et utilisation de `coord_flip()`).

```{r, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
# Boxplots + geom_jitter()
ggplot(data = pingouins,
       mapping = aes(x = espece,
                     y = masse_g)) +
  geom_boxplot(aes(colour = espece,
                   fill = espece),
               show.legend = FALSE,
               outlier.shape = NA,
               width = 0.25,
               alpha = 0.5,
               lwd = 0.75) +
  geom_jitter(aes(colour = espece),
             show.legend = FALSE,
             alpha = 0.25,
             width = 0.25) +
  scale_colour_manual(values = c("Adelie" = "darkorange",
                                 "Chinstrap" = "purple",
                                 "Gentoo" = "cyan4")) +
  scale_fill_manual(values = c("Adelie" = "darkorange",
                                 "Chinstrap" = "purple",
                                 "Gentoo" = "cyan4")) +
  labs(title = "Distribution de la masse corporelle",
       subtitle = "pour trois espèces de pingouins de l'archipel Palmer",
       x = "",
       y = "Masse (g)") +
  coord_flip() +
  theme_minimal()
```

## Diagramme en bâtons (bar plot) {#barplot}

**Quelle espèce compte le plus de pingouins ?**  
Nous allons utiliser `geom_bar()` pour visualiser le nombre de pingouins par espèce : 

```{r, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
# Barplot
ggplot(data = pingouins,
       mapping = aes(x = espece,
                     fill = espece)) +
  geom_bar(show.legend = FALSE) +
  scale_fill_manual(values = c("Adelie" = "darkorange",
                               "Chinstrap" = "purple",
                               "Gentoo" = "cyan4")) +
  labs(title = "Nombre de pingouins",
       subtitle = "pour trois espèces de l'archipel Palmer",
       x = "",
       y = "") +
  theme_minimal()
```

Les espèces étant déjà notées sur l'axe x, nous utilisons `show.legend = FALSE` pour alléger le graphique.

Nous souhaiterions ajouter des étiquettes de texte au-dessus des barres pour indiquer le nombre de pingouins par espèce. Nous allons pour cela ajouter une couche à l'aide de `geom_text()` : 

- `aes(label = ..count..)` : indique que les étiquettes contiendront le nombre d'observations par groupe défini précédemment (les espèces).

- `stat = "count"` : nécessaire pour que le code fonctionne.  

- `vjust = -1` : alignement vertical des étiquettes, vous pouvez essayer différentes valeurs pour voir le résultat.

```{r, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
# Barplot + geom_text()
ggplot(data = pingouins,
       mapping = aes(x = espece,
                     fill = espece)) +
  geom_bar(show.legend = FALSE) +
  geom_text(aes(label = ..count..),
            stat = "count",
            vjust = -1) +
  scale_fill_manual(values = c("Adelie" = "darkorange",
                               "Chinstrap" = "purple",
                               "Gentoo" = "cyan4")) +
  labs(title = "Nombre de pingouins",
       subtitle = "pour trois espèces de l'archipel Palmer",
       x = "",
       y = "") +
  theme_minimal()
```

Vous pouvez voir que l'étiquette pour l'espèce Adélie est coupée ... il y a plusieurs façons de régler ce problème. Nous allons simplement positionner les étiquettes à l'intérieur des barres, augmenter la taille des caractères et colorer le texte en blanc pour le rendre plus lisible.

```{r, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
# Barplot + geom_text() + texte dans les barres
ggplot(data = pingouins,
       mapping = aes(x = espece,
                     fill = espece)) +
  geom_bar(show.legend = FALSE) +
  geom_text(aes(label = ..count..),
            stat = "count",
            vjust = 1.5,
            colour = "white",
            size = 5) +
  scale_fill_manual(values = c("Adelie" = "darkorange",
                               "Chinstrap" = "purple",
                               "Gentoo" = "cyan4")) +
  labs(title = "Nombre de pingouins",
       subtitle = "pour trois espèces de l'archipel Palmer",
       x = "",
       y = "") +
  theme_minimal()
```

Comme vous pouvez le voir, les espèces sont placées le long de l'axe x par ordre alphabétique. Nous préférerions qu'elles soient triées par ordre décroissant de nombre de pingouins. Nous allons voir trois façons de procéder : 

**1) créer un objet intermédiaire** : approche à éviter car elle ajoute un objet dans l'environnement et n'est **pas dynamique**, c'est-à-dire que le code ne sera pas utilisable pour d'autres cas de figure.

```{r, echo=TRUE, eval=FALSE, message=FALSE, warning=FALSE}
# Tri avec création d'un objet intermédiaire

pingouins_tri <- pingouins %>% 
  mutate(espece = factor(espece,
                         levels = c("Adelie", "Gentoo", "Chinstrap")))

ggplot(data = pingouins_tri,
       mapping = aes(x = espece,
                     fill = espece)) +
  geom_bar(show.legend = FALSE) +
  geom_text(aes(label = ..count..),
            stat = "count",
            vjust = 1.5,
            colour = "white",
            size = 5) +
  scale_fill_manual(values = c("Adelie" = "darkorange",
                               "Chinstrap" = "purple",
                               "Gentoo" = "cyan4")) +
  labs(title = "Nombre de pingouins",
       subtitle = "pour trois espèces de l'archipel Palmer",
       x = "",
       y = "") +
  theme_minimal()
```

**2) modifier l'objet *pingouins* dans la fonction ggplot** : cette approche utilise la fonction `mutate()` du package `dplyr` pour créer le facteur espece. Le code sera ré-utilisable et ne crée pas de nouvel objet dans l'environnement. Il nous faut par contre déterminer les niveaux du facteur avec `levels()`.

```{r, echo=TRUE, eval=FALSE, message=FALSE, warning=FALSE}
# Tri dans la fonction ggplot() à l'aide de mutate()

ggplot(data = mutate(pingouins,
                     espece = factor(espece,
                                     levels = c("Adelie", "Gentoo", "Chinstrap"))),
       mapping = aes(x = espece,
                     fill = espece)) +
  geom_bar(show.legend = FALSE) +
  geom_text(aes(label = ..count..),
            stat = "count",
            vjust = 1.5,
            colour = "white",
            size = 5) +
  scale_fill_manual(values = c("Adelie" = "darkorange",
                               "Chinstrap" = "purple",
                               "Gentoo" = "cyan4")) +
  labs(title = "Nombre de pingouins",
       subtitle = "pour trois espèces de l'archipel Palmer",
       x = "",
       y = "") +
  theme_minimal()
```

**3) utiliser les fonctionnalités du package `forcats`** : ce package, qui fait partie du Tidyverse, permet d'effectuer des opérations sur des facteurs. C'est l'**approche la plus dynamique** : R transforme une variable en facteur et détermine automatiquement les niveaux. Nous n'avons donc plus besoin de préciser les niveaux. Nous pouvons par exemple trier les niveaux d'un facteur par ordre d'apparition avec `fct_inseq()`, ou par ordre de nombre d'observations à l'aide de `fct_infreq()`.

```{r, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
# Tri dans la fonction ggplot() à l'aide des fonctionnalites du package forcats

ggplot(data = mutate(pingouins,
                     espece = fct_infreq(espece)),
       mapping = aes(x = espece,
                     fill = espece)) +
  geom_bar(show.legend = FALSE) +
  geom_text(aes(label = ..count..),
            stat = "count",
            vjust = 1.5,
            colour = "white",
            size = 5) +
  scale_fill_manual(values = c("Adelie" = "darkorange",
                               "Chinstrap" = "purple",
                               "Gentoo" = "cyan4")) +
  labs(title = "Nombre de pingouins",
       subtitle = "pour trois espèces de l'archipel Palmer",
       x = "",
       y = "") +
  theme_minimal()
```

<br>

Comme nous l'avions fait pour les boxplots, nous pouvons changer l'orientation des barres. Nous allons modifier quelques éléments du code : 

- en basculant les espèces le long de l'axe y, l'espèce ayant le plus grand nombre de pingouins va se retrouver en bas du graphique. En effet, la variable **espece** étant un facteur avec des niveaux ordonnés, le premier niveau du facteur se retrouve au plus près de l'origine de l'axe : à gauche si les barres sont orientées verticalement, en bas si elles sont orientées horizontalement. Pour inverser l'ordre des niveaux, nous utilisons `fct_rev()`.

- nous modifions l'alignement des étiquettes en remplaçant `vjust` par `hjust`  

- nous réduisons la largeur des barres à l'aide du paramètre `width`

```{r, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
# Barplot horizontal

ggplot(data = mutate(pingouins,
                     espece = fct_rev(fct_infreq(espece))),
       mapping = aes(x = espece,
                     fill = espece)) +
  geom_bar(width = 0.75,
           show.legend = FALSE) +
  geom_text(aes(label = ..count..),
            stat = "count",
            hjust = 1.5,
            colour = "white",
            size = 5) +
  scale_fill_manual(values = c("Adelie" = "darkorange",
                               "Chinstrap" = "purple",
                               "Gentoo" = "cyan4")) +
  labs(title = "Nombre de pingouins",
       subtitle = "pour trois espèces de l'archipel Palmer",
       x = "",
       y = "") +
  coord_flip() +
  theme_minimal()
```

<br>

### Une note sur l'utilisation du pipe `%>%`  

Nous pouvons également utiliser le **pipe `%>%`** que nous avions vu dans le tutoriel sur le Tidyverse pour enchaîner les opérations de tri puis la création du graphique.

Cette façon de procéder permet, quand nous manipulons un jeu de données (ajout d'une colonne par exemple), de s'assurer que nous n'avons pas fait d'erreur avant de générer le graphique, le tout sans avoir besoin de créer d'objet intermédiaire. L'utilisation du pipe permet également de bénéficier de l'auto-complétion à l'aide de la touche `Tab`, ce qui est plutôt appréciable quand nos variables portent des noms complexes ou que le code contient de nombreux paramètres.

```{r, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
# Utilisation du pipe %>%

pingouins %>% 
  mutate(espece = fct_rev(fct_infreq(espece))) %>% 
  ggplot(mapping = aes(x = espece,
                       fill = espece)) +
  geom_bar(width = 0.75,
           show.legend = FALSE) +
  geom_text(aes(label = ..count..),
            stat = "count",
            hjust = 1.5,
            colour = "white",
            size = 5) +
  scale_fill_manual(values = c("Adelie" = "darkorange",
                               "Chinstrap" = "purple",
                               "Gentoo" = "cyan4")) +
  labs(title = "Nombre de pingouins",
       subtitle = "pour trois espèces de l'archipel Palmer",
       x = "",
       y = "") +
  coord_flip() +
  theme_minimal()
```


# Graphiques multiples {#facet}

Quel est le **rapport entre la longueur du bec et la longueur des ailes** ? 

Nous pouvons créer un nuage de points avec les trois espèces sur un même graphique, comme nous l'avons fait jusqu'ici : 

```{r, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
# Scatter plot : 1 graphique pour les 3 especes

pingouins %>% 
  mutate(espece = fct_rev(fct_infreq(espece))) %>% 
  ggplot(mapping = aes(x = espece,
                       fill = espece)) +
  geom_bar(width = 0.75,
           show.legend = FALSE) +
  geom_text(aes(label = ..count..),
            stat = "count",
            hjust = 1.5,
            colour = "white",
            size = 5) +
  scale_fill_manual(values = c("Adelie" = "darkorange",
                               "Chinstrap" = "purple",
                               "Gentoo" = "cyan4")) +
  labs(title = "Nombre de pingouins",
       subtitle = "pour trois espèces de l'archipel Palmer",
       x = "",
       y = "") +
  coord_flip() +
  theme_minimal()
```


Nous souhaitons maintenant visualiser ces données en sépérant les graphiques par espece et par ile.

Nous pourrions pour cela créer séparément les graphiques à l'aide de la fonction `filter()`. `ggplot2` possède deux fonctions qui le font directement : **`facet_wrap()`** et **`facet_grid()`**.

## `facet_wrap()`  

Nous allons simplement ajouter une couche à notre graphique précédent en précisant quelle variable sert à séparer les données (à l'aide d'un **tilde ~**). Nous modifions également le thème pour rendre les noms des espèces plus lisibles :

```{r, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
# facet_wrap() : 1 graphique par espece
ggplot(data = pingouins,
       mapping = aes(x = aile_lngr_mm,
                     y = bec_lngr_mm)) +
  geom_point(aes(colour = espece),
             size = 3,
             alpha = 0.5,
             show.legend = FALSE) +
  scale_colour_manual(values = c("Adelie" = "darkorange",
                                 "Chinstrap" = "purple",
                                 "Gentoo" = "cyan4")) +
  labs(title = "Rapport entre la longueur du bec et la longueur des ailes",
       subtitle = "pour trois espèces de l'archipel Palmer",
       x = "Longueur de l'aile (mm)",
       y = "Longueur du bec (mm)") +
  facet_wrap(~espece) +
  theme_light()
```

Nous pouvons modifier l'orientation des graphiques à l'aide du paramètre `dir = ...` (par défaut `h`, `v` pour des graphiques orientés verticalement).  

Nous pouvons également déplacer l'étiquette de titre (noms des espèces dans notre cas) avec le paramètre `strip.position = ...` (par défaut `top`, peut prendre les valeurs `right`, `bottom` ou `left`) : 

```{r, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
# facet_wrap() : 1 graphique par espece + paramètres
ggplot(data = pingouins,
       mapping = aes(x = aile_lngr_mm,
                     y = bec_lngr_mm)) +
  geom_point(aes(colour = espece),
             size = 3,
             alpha = 0.5,
             show.legend = FALSE) +
  scale_colour_manual(values = c("Adelie" = "darkorange",
                                 "Chinstrap" = "purple",
                                 "Gentoo" = "cyan4")) +
  labs(title = "Rapport entre la longueur du bec et la longueur des ailes",
       subtitle = "pour trois espèces de l'archipel Palmer",
       x = "Longueur de l'aile (mm)",
       y = "Longueur du bec (mm)") +
  facet_wrap(~espece,
             dir = "v",
             strip.position = "right") +
  theme_light()
```


Commençons par placer les données des trois espèces sur un seul graphique : 


La fonction `facet_wrap()` s'utilise simplement en précisant quelle variable va nous servir à séparer nos données (la variable **espèce** dans notre cas), précédée d'un **tilde ~** : 

```{r, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
# Rapport entre la longueur du bec et la longueur des ailes - 1 graphique par espèce
ggplot(data = pingouins,
       mapping = aes(x = aile_lngr_mm,
                     y = bec_lngr_mm)) +
  geom_point(aes(colour = espece),
             show.legend = FALSE) +
  scale_colour_manual(values = c("Adelie" = "darkorange",
                               "Chinstrap" = "purple",
                               "Gentoo" = "cyan4")) +
  labs(title = "Rapport entre la longueur du bec et la longueur des ailes",
       subtitle = "pour trois espèces de l'archipel Palmer",
       x = "Longueur de l'aile (mm)",
       y = "Longueur du bec (mm") +
  facet_wrap(~espece) +
  theme_minimal()
```

Pour simplifier la lecture de ce graphique, nous pouvons **utiliser un autre thème** : 

```{r, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
# Changer le thème
ggplot(data = pingouins,
       mapping = aes(x = aile_lngr_mm,
                     y = bec_lngr_mm)) +
  geom_point(aes(colour = espece),
             show.legend = FALSE) +
  scale_colour_manual(values = c("Adelie" = "darkorange",
                               "Chinstrap" = "purple",
                               "Gentoo" = "cyan4")) +
  labs(title = "Rapport entre la longueur du bec et la longueur des ailes",
       subtitle = "pour trois espèces de l'archipel Palmer",
       x = "Longueur de l'aile (mm)",
       y = "Longueur du bec (mm") +
  facet_wrap(~espece) +
  theme_light()
```

# Exporter un graphique {#exporter}

Jusqu'à présent, nos différents graphiques apparaissaient dans le panneau **Viewer** de RStudio, mais n'étaient pas sauvegardés.

Il existe plusieurs façons d'exporter un graphique :  

**- A partir du panneau Viewer** : en cliquant sur **Export**, vous aurez le choix entre sauvegarder votre graphique sous forme d'**image** ou de **fichier pdf**, ou vous pourrez le copier dans le presse-papiers (par exemple pour le coller dans un document). Nous allons le sauvegarder sous forme d'image.

```{r, layout="l-body"}
knitr::include_graphics("img/export_ggplot_01.png")
```

Vous aurez alors le choix entre plusieurs **formats** (`.png`, `.jpeg`, ...). Vous pourrez également **redimensionner** votre graphique (en conservant ou non le ratio des dimensions), choisir le **dossier de destination** et **renommer** votre fichier (le nom proposé par défaut n'est pas très explicite ...).

```{r, layout="l-body"}
knitr::include_graphics("img/export_ggplot_02.png")
```

<br>

**- En utilisant la fonction `ggsave()` : il vous faudra d'abord assigner votre graphique dans un objet. R est ce qu'on appelle un **langage orienté objet**, ce qui veut dire que tout ce que vous manipulez dans votre session R (les fichiers importés, les transformations, les fonctions, et même les graphiques !) sont stockés dans la mémoire vive sous forme d'objet.

Vous pouvez simplement ajouter un nom d'objet et une flèche d'assignation devant le code ayant servi à générer votre dernier graphique : `barplot_especes <- ggplot(...`. Votre graphique (y compris toutes les couches ajoutées et les paramètres) est stocké dans l'objet **barplot_especes**. Vous n'aurez par contre pas d'aperçu de votre graphique dans le panneau **Viewer** comme c'était le cas jusque là. Vous pouvez simplement appeler l'objet créé pour l'afficher, ou entourer l'ensemble de ce code par des parenthèses pour effectuer les deux opérations à la fois : stocker le graphique dans un objet et l'afficher dans le panneau Viewer.

```{r, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
# Assigner le bar plot à l'obet barplot_especes et l'afficher
(barplot_especes <- pingouins %>% 
   mutate(espece = fct_rev(fct_infreq(espece))) %>% 
   ggplot(aes(x = espece,
              fill = espece)) +
   geom_bar(show.legend = FALSE,
            width = 0.5) +
   scale_fill_manual(values = c("Adelie" = "darkorange",
                                "Chinstrap" = "purple",
                                "Gentoo" = "cyan4")) +
  labs(title = "Nombre de pingouins",
       subtitle = "pour trois espèces de l'archipel Palmer",
       x = "",
       y = "") +
   coord_flip() +
   theme_minimal()
)
```

Créons maintenant un répértoire **figs/** dans notre répertoire de travail (à l'aide de **New Folder** dans l'onglet **Files** dans RStudio) et sauvegardons notre graphique : 

```{r, echo=TRUE, eval=FALSE, message=FALSE, warning=FALSE}
ggsave("figs/barplot_especes.png", barplot_especes, dpi = 320, width = 12, height = 6)
```

Décortiquons cette commande pour comprendre sa syntaxe : 

- **`figs/barplot_especes.png` : répertoire de destination et nom sous lequel sauvegarder le graphique

- **`barplot_especes` : nom de l'objet dans lequel le graphique est stocké. Vous pouvez également utiliser la fonction `last_plot()` pour sauvegarder le dernier graphique.

-**`dpi = 320`** : résolution de l'image

-**`width = 12`** : largeur de l'image

-**`height = 6`** : hauteur de l'image

Il existe d'autres paramètres, n'hésitez pas explorer l'aide de la fonction à l'aide de la commande `?ggsave`. Vous pouvez essayer différentes options et valeurs pour voir le résultat.

Ouvrez le fichier `barplot_especes.png` et comparez ce fichier avec le visuel affiché dans votre session RStudio. Il n'est pas rare d'avoir quelques surprise ! La taille des lettres peut par exemple être plus petite dans le fichier exporté que dans l'aperçu RStudio. Il est toujours utile d'exporter son graphique et de vérifier le rendu pour rectifier les paramètres si nécessaire.

```{r, layout="l-body"}
knitr::include_graphics("img/barplot_especes.png")
```

# Améliorer ses graphiques {#ameliorer}

Nous avons vu comment créer les principaux types de graphiques ainsi que certains paramètres permettant de modifier leur apparence. Il existe énormément de paramètres permettant de modifier nos graphiques pour les rendre plus attractifs. Les possibilités sont pour ainsi dire infinies ! 

<br>

La suite de ce tutoriel vous donnera quelques éléments pour améliorer vos graphiques, n'hésitez pas à aller voir la section **Liens** du blog pour trouver d'autres ressources qui vous aideront à creuser encore davantage les possibilités de `ggplot2`.

## Modifier l'arrière-plan

Commençons par un paramètre assez évident, à savoir la couleur de l'arrière-plan. Les thèmes prédéfinis dans `ggplot2` vous donnent quelques possibilités, mais vous pouvez en réalité choisir n'importe quelle couleur, pour peu que vous ayiez son nom ou son code hexadécimal. 

Nous allons reprendre le barplot du nombre de pingouins par espèce et y apporter des modifications, en montrant le résultat étape par étape.

Le paramètre `theme()` va vous permettre d'ajuster tous les paramètres de votre graphique (et la liste est très longue !).

<br>

Votre graphique se compose de deux grandes parties : 

- le **"panel"** qui contient les éléments de visualisation (le graphique lui-même)  

- le **plot** qui contient tout ce qui est autour : titre, légende, titres des axes, ...

Nous allons commencer par modifier la couleur de l'arrière-plan de la zone du graphique, à l'aide du paramètre `panel.background()`. Nous allons dans ce paramètre préciser la couleur de l'intérieur et du contour de la zone du graphique (comme nous l'avions fait plus haut en modifiant la forme et les couleurs des points) à l'aide des paramètres `fill` et `colour` au sein d'un argument `element_rect()` : 

```{r, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
# Modifier la couleur de l'arrière-plan de la zone du graphique
pingouins %>% 
   mutate(espece = fct_rev(fct_infreq(espece))) %>% 
   ggplot(aes(x = espece,
              fill = espece)) +
   geom_bar(show.legend = FALSE,
            width = 0.5) +
   scale_fill_manual(values = c("Adelie" = "darkorange",
                                "Chinstrap" = "purple",
                                "Gentoo" = "cyan4")) +
  labs(title = "Nombre de pingouins",
       subtitle = "pour trois espèces de l'archipel Palmer",
       x = "",
       y = "") +
   coord_flip() +
   theme_minimal() +
  theme(panel.background = element_rect(fill = "#1d3557", colour = NA))
```

Pour modifier la couleur de l'arrière-plan de la zone autour du graphique, nous procédons de la même façon à l'aide du paramètre **`plot.background()`** : 

```{r, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
# Modifier la couleur de l'arrière-plan de la zone autour du graphique
pingouins %>% 
   mutate(espece = fct_rev(fct_infreq(espece))) %>% 
   ggplot(aes(x = espece,
              fill = espece)) +
   geom_bar(show.legend = FALSE,
            width = 0.5) +
   scale_fill_manual(values = c("Adelie" = "darkorange",
                                "Chinstrap" = "purple",
                                "Gentoo" = "cyan4")) +
  labs(title = "Nombre de pingouins",
       subtitle = "pour trois espèces de l'archipel Palmer",
       x = "",
       y = "") +
   coord_flip() +
   theme_minimal() +
  theme(panel.background = element_rect(fill = "#1d3557", colour = NA),
        plot.background = element_rect(fill = "#1d3557", colour = NA))
```

## Modifier la grille

Certaines lignes de la grille peuvent devenir inutiles. Dans notre cas, les lignes horizontales de la grille ne sont pas nécessaires à la compréhension du graphique. Nous allons pouvoir modifier ces éléments à l'aide des paramètres `panel.grid`. : 

- **`panel.grid`** : modifier toutes les lignes

- **`panel.grid.major`** : modifier les lignes principales 

- **`panel.grid.minor`** : modifier les lignes secondaires

- **`panel.grid.major.x`** : modifier les lignes principales de l'axe x

- **`panel.grid.major.y`** : modifier les lignes principales de l'axe y

- **`panel.grid.minor.x`** : modifier les lignes secondaires de l'axe x

- **`panel.grid.minor.y`** : modifier les lignes secondaires de l'axe y

<br>

Nous procédons de la façons suivante : 

**1) Supprimer toutes les lignes secondaires** : `panel.grid.minor = element_blank()`  

**2) Modifier les lignes principales de l'axe en lignes pointillées** : `panel.grid.major.x = element_line(linetype = "dotted)`

**3) Supprimer les lignes principales de l'axe y** : `panel.grid.major.y = element_blank()`

```{r, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
# Modifier la grille
pingouins %>% 
  mutate(espece = fct_rev(fct_infreq(espece))) %>% 
  ggplot(aes(x = espece,
             fill = espece)) +
  geom_bar(show.legend = FALSE,
           width = 0.5) +
  scale_fill_manual(values = c("Adelie" = "darkorange",
                               "Chinstrap" = "purple",
                               "Gentoo" = "cyan4")) +
  labs(title = "Nombre de pingouins",
       subtitle = "pour trois espèces de l'archipel Palmer",
       x = "",
       y = "") +
  coord_flip() +
  theme_minimal() +
  theme(panel.background = element_rect(fill = "#1d3557", colour = NA),
        plot.background = element_rect(fill = "#1d3557", colour = NA),
        panel.grid.minor = element_blank(),
        panel.grid.major.x = element_line(linetype = "dotted"),
        panel.grid.major.y = element_blank())
```


## Le texte 

L'arrière-plan plus sombre rend le texte difficilement lisible. Nous pouvons modifier la couleur et la taille du texte utilisé dans le titre, le sous-titre, les titres des axes et les étiquettes de axes.

Plusieurs paramètres permettent de modifier du texte : 

- **family** : police de caractères 

- **colour** : couleur du texte

- **size** : taille du texte (valeurs numériques)

- **hjust** : alignement horizontal du texte

- **vjust** : alignement vertical du texte

<aside>
0 (à gauche), 0.5 (centre) ou 1 (droite)
</aside>

Ces paramètres peuvent être appliqués séparément au titre, au sous-titre, aux titres des axes et aux étiquettes des axes.

Le package `showtext()` permet d'utiliser des polices **Google fonts** dans nos graphiques, n'hésitez pas à fouiller pour trouver celle qui vous convient ! 

Installer et charger le package showtext : 

```{r, echo=TRUE, eval=FALSE, message=FALSE, warning=FALSE}
# Installer et charger le package showtext
install.packages("showtext")
library(showtext)
```

Nous allons utiliser la police **Righteous** :

```{r, echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
library(showtext)
```

```{r, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
font_add_google("Righteous", "Righteous")
showtext_auto()
```

Nous pouvons maintenant modifier les paramètres en procédant de la manière suivante : 

- **modifier la police, la taille, la couleur et l'alignement du titre** : `plot.title = element_text(family = "Righteous", colour = "white", size = 25, hjust = 0.5)`  

- **modifier la police, la taille, la couleur et l'alignement du sous-titre** : `plot.subtitle = element_text(family = "Righteous", colour = "white", size = 15, hjust = 0.5)`

- **modifier la police, la taille et la couleur du texte des axes** : `axis.text = element_text(family = "Righteous", colour = "white", size = 12)`

```{r, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
# Modifier le texte
pingouins %>% 
  mutate(espece = fct_rev(fct_infreq(espece))) %>% 
  ggplot(aes(x = espece,
             fill = espece)) +
  geom_bar(show.legend = FALSE,
           width = 0.5) +
  scale_fill_manual(values = c("Adelie" = "darkorange",
                               "Chinstrap" = "purple",
                               "Gentoo" = "cyan4")) +
  labs(title = "Nombre de pingouins",
       subtitle = "pour trois espèces de l'archipel Palmer",
       x = "",
       y = "") +
  coord_flip() +
  theme_minimal() +
  theme(panel.background = element_rect(fill = "#1d3557", colour = NA),
        plot.background = element_rect(fill = "#1d3557", colour = NA),
        panel.grid.minor = element_blank(),
        panel.grid.major.x = element_line(linetype = "dotted"),
        panel.grid.major.y = element_blank(),
        plot.title = element_text(family = "Righteous", colour = "white",
                                  size = 25, hjust = 0.5),
        plot.subtitle = element_text(family = "Righteous", colour = "white",
                                     size = 15, hjust = 0.5),
        axis.text = element_text(family = "Righteous", colour = "white",
                                 size = 12))
```
